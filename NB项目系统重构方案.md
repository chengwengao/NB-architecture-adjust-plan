# NB项目系统架构调整方案

---

# 一、项目背景

## 1、烟感项目运行终端

* web端软件系统平台

* Andoriod app

* IOS app

* 微信公众号

## 2、烟感项目原始技术栈

烟感项目外包人员选用的主要技术栈如下：

`mirth connect + vue + h5 + hbuilder + Tomcat 等(下文 mirth connect 简称mirth) + mysql`

## 3、原始技术栈解读

* 接口实现

web后端采用mirth作为后台接口提供者，web前端采用vue开发；

Android和IOS app采用vue开发的h5页面，然后通过hbuilder打包成apk或ipa的安装包实现，移动端app的后台接口均由mirth提供；

微信公众号主要采用html+css方式实现前端页面，后端还是采用mirth接口提供方式；

* 运行容器

前端页面采用Tomcat作为静态资源运行容器，后台接口采用mirth作为运行容器和请求接口转发工具；

## 4、原始技术栈优点\(主要针对mirth\)

备注：后文所有技术对比将着重针对mirth，其他技术点不做重点探讨！

* 现有技术选型满足目前业务应用场景，包括与第三方平台对接与新的业务需求实现；

* mirth后端支持热部署，可实现在不重启后端服务器的情况下几乎实时更新后台代码，用户零感知；

* mirth + postman可快速开发与第三方数据对接的需求，充分发挥mirth强大的数据接口引擎特色；

* 简单的配置可以让mirth支持跨域访问；

## 5、原始技术栈的缺点\(主要针对mirth\)

* 免费版的mirth未提供诸如java一样发达、完善的源代码管理与追踪体系，采用mirth开发的后端代码在版本管理和过程追溯方面体验相当差；

* mirth比较小众，新人入职有学习成本，相对目前生态良好的java开发人员而言，招一个懂mirth甚至是愿意学mirth的人比招java的开发人员要难得多；

* mirth作为外包的技术壁垒，每次开发新的需求都伴随着高昂的成本，如果让内部研发使用mirth开发，在项目紧急急需扩充研发人员的情况下，其他项目组的研发无法提供开发支持；

* mirth中没有提供的api只能通过调用外部jar的形式引入，jar包修改后需求重启mirth服务，如果jar包众多，这就为以后jar的管理带来很多的麻烦；

* mirth中的javascript脚本虽然支持大多数js数据类型和语法，但是在调用外部jar包的传参时，对非json或者字符串格式的数据（比如对象）无法支持；

## 6、原始后端架构缺点

* 表结构设计不是很合理；

* 部分逻辑查询sql书写太复杂；

* 未考虑后面数据量增长表的可扩展性，部分表可以采取分表策略；

# 二、要求

针对目前项目现状，需要对web端平台进行重构。

# 三、技术选型

## 1、选型原则

* 保证现有系统稳定；

* 对现有系统架构设计代码侵入尽可能少；

* 选用新架构和框架必须是经过生产环境检验，保证稳定运行的；

* 升级过程相对简单可靠；

* 新架构和框架可维护性高，要能有效解决mirth现有暴露的缺点；

## 2、选型思路：

\(1\)微信公众号：

* 前端：微信公众号目前只需维护若干html和js文件，暂无替换必要；

* 后端：由mirth提供后台接口，老的接口暂时还是在mirth中维护，重构优先级低；

（2）Android和IOS APP

* 前端：移动端前端均采用vue，编译后再通过Hbuilder打包生成安装包，暂无替换必要；

* 后端：由mirth提供后台接口，老的接口暂时还是在mirth中维护，重构优先级低；

（3）web端软件平台

* 前端：采用vue,暂无替换必要；

* 后端：由mirth提供后台接口，需要替换；

总结：目前负责前端交互的vue暂无需替换，由于负责后端交互的mirth与业务逻辑耦合较大，重构需要的时间成本较高，且短时间无法保证稳定性，因此重构时**优先保证用户权限整个体系走通，再在新框架上添砖加瓦，优先级较高的需求优先开发，采用敏捷开发思路，持续迭代交付**。

## 3、选型方案

前端保持原有的vue，后端选用成熟的java，弃用mirth，考虑到外包之前设计的权限框架问题比较多，所以前端虽然选择vue，但目前使用的vue框架可能只有参考价值，前端权限框架体系可能需要重新设计。

前端：

* vue

后端：

* 语言：java
* 框架：springboot
* 权限控制：shiro
* 数据库：mysql

## 4、选型依据

* vue渐进式前端框架，生态良好，经过了生产环境的考验；
* java生态丰富，成熟，第三方类库众多，优点不一一赘述；
* springboot模块化开发，对jar包管理更智能；
* shiro框架对权限控制方案比较成熟；

## 5、可行性验证

之前的出入库管理模块已采用java + springboot完成架构调整并在生产环境稳定运行。



